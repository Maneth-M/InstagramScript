{% extends "projects/base.html" %}
{% load bootstrap5 %}
{% load static %}
{% load humanize %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'projects/gallery.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'projects/card.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'projects/load.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
{% endblock head %}
{% block content %}

<div id="main" class="m-2">

{# Search Bar #}

    <div class="container h-100 mt-5 mr-5">
        <form method="GET">
            <div class="container d-flex flex-row-reverse">
                <div class="d-flex justify-content-center h-100">
                    <div class="searchbar">
                        <input class="search_input" type="text" name="key" placeholder="Search Username">
                        <input type="hidden" name="id" value="{{ id }}">
                        <button type="submit" class="search_icon"><i class="fas fa-search"></i></button>

                    </div>
                </div>
            </div>

        </form>
    </div>



{# Search Result #}

    {% if check != None %}
    {% else %}
        <div>
            {% if results == '' %}

            {% elif results == "e" %}

            <h2>System Error or the Account Doesn't exist. Please try again in a few minutes</h2>
            {% else %}
                <div class="container mr-5">
                    <div class="twPc-div">
                        <a class="twPc-bg twPc-block"></a>
                        <div>
                            <div class="twPc-button">
                                <form method="POST">
                                    {% csrf_token %}
                                    <div class="d-flex justify-content-center h-100">
                                        <div class="searchbar">
                                            <input type="hidden" name="acc" value="{{ results.username }}">
                                            <input type="hidden" name="id" value="{{ id }}">
                                            <button class="btn btn-dark" type="submit">add {{ results.username }}</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <a title={{ results.username }} href="https://instagram.com/{{ results.username }}" class="twPc-avatarLink">
                                <img alt="{{ results.username }}" src={% static 'accounts/profilePictures/'|add:results.pk|add:'.png' %} class="twPc-avatarImg">
                            </a>

                            <div class="twPc-divUser">
                                <div class="twPc-divName">
                                    <a href="https://instagram.com/{{ result.username }}">@{{ results.username }}</a>
                                </div>
                                <span>
                    </span>
                            </div>
                            <div class="twPc-divStats">
                                <ul class="twPc-Arrange">
                                    <li class="twPc-ArrangeSizeFitArrangeSizeFit">
                                        <span class="twPc-StatLabel twPc-block">posts</span>
                                        <span class="twPc-StatValue">{{ results.media_count|intcomma }}</span>
                                    </li>
                                    <li class="twPc-ArrangeSizeFit">
                                        <span class="twPc-StatLabel twPc-block">Following</span>
                                        <span class="twPc-StatValue">{{ results.following_count|intcomma }}</span>
                                    </li>
                                    <li class="twPc-ArrangeSizeFit">
                                        <span class="twPc-StatLabel twPc-block">Followers</span>
                                        <span class="twPc-StatValue">{{ results.follower_count|intcomma }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

{# Show Added Accounts #}
    <div class="container-fluid mt-5">
        <div class="px-lg-5 ">
            <div class="row">
                {% if accounts %}
                    <script>
                        function showLoading() {
                            document.getElementById('load').style.display = "block";
                            document.getElementById('main').style.display = "none";
                        }
                    </script>


                    <div >
                        <a class="btn btn-outline-dark mb-5" style="width: 100%" href="analyze/?id={{ id }}" onclick="showLoading()">Analyze Accounts</a>
                    </div>
                        {% for account in accounts %}
                            <div class="col-xl-2 col-lg-4 col-md-6 mb-4 d-flex justify-content-center h-100">
                                <div class="bg-white rounded shadow-sm w-50 h-50 ml-5"><img src="{% static 'accounts/profilePictures/'|add:account.account.userId|add:'.png' %}" alt="" class="img-fluid card-img-top">
                                    <div class="p-4">
                                        <h5> <a href="#" class="text-dark">{{ account.account.username }}</a></h5>
                                        <div class="d-flex justify-content-center h-100">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Followers
                                                    <span class="badge badge-primary badge-pill">{{ account.account.followers.today|intcomma }}</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Following
                                                    <span class="badge badge-primary badge-pill">{{ account.account.following.today|intcomma }}</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Posts
                                                    <span class="badge badge-primary badge-pill">{{ account.account.media.today|intcomma }}</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                {% else %}
                    <h2>You haven't added any accounts yet</h2>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="loader" id="load" style="display: none">Analyzing...</div>

{% endblock content %}

